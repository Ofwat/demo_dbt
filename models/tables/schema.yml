version: 2

models:
    - name: D_Element
      description: "Table with Elements information model"
      columns:
          - name: element_id
            description: "Unique id of Element"
            tests:
              - unique
              - not_null
          - name: element_name
            description: "Name of Element"
            tests:
              - unique
              - not_null
              - accepted_values:
                  values: ['Retail (HH)','Retail (NH)','Thames Tideway','Wastewater','Water']
          - name: element_acronym
            description: "Acronym of Element"
            tests:
              - unique
              - not_null
    - name: D_Water_company
      description: "Table with company name and acronyms used"
      columns:
          - name: water_company_id
            description: "Id given to company(hash value)"
            tests:
              - unique
              - not_null 
          - name: water_company_acronym
            description: "Acronym used for a company name"
            tests:
              - unique
              - not_null 
          - name: water_company_name
            description: "Company names"
            tests:
              - unique
              - not_null 
          - name: water_company_type
            description: "Type of company WaSC or WoC"
            tests:
              - not_null 
          - name: water_company_type_description 
            description: "Description for the water company type"
            tests:
              - not_null
    - name: D_Performance_commitment
      description: "Table with Performance commitments and information for them"
      columns:
          - name: performance_commitment_id
            description: "Id given to Performance commitments(hash value)"
            tests:
              - unique
              - not_null 
          - name: pc_name
            description: "Name for Performance commitments"
            # PC name will not be unique as same PC might hv diff units
            tests:
              - not_null 
          - name: primary_category
            description: "Primary category
                          We have allocated a primary category to each PC. This is an experimental indicator and not an exact science as many PCs overlap categories.
                          We have included the primary category as a means of sign-posting similar PCs. It should be noted that PCs with the same primary category may not be directly comparable. Please refer to:
                          • the relevant PR14 final determination company-specific appendix (annex 4) for individual PC definitions; and
                          • the outcomes policy chapter for details of where we used comparative analysis at PR14.
                          These documents are available to download from the Ofwat website:
                          http://www.ofwat.gov.uk/regulated-companies/price-review/price-review-2014/final-determinations/"
            # primary_category will not be unique
            tests:
              - not_null 
          - name: pc_unit
            description: "Unit for Performance commitments eg %, £m, category, N/A, nr, rank, score, TBC, text, time"
            tests:
              - not_null 
          - name: pc_unit_description
            description: "Description of the PC unit - free-format with no validation"
            tests:
              - not_null
          - name: decimal_places
            description: "Number of decimal places used (where applicable)"
            tests:
              - not_null
    - name: D_ODI_form
      description: "Table with ODI form"
      columns:
          - name: odi_form_id
            description: "Id given to ODI form"
            tests:
              - unique
              - not_null 
          - name: odi_form_name
            description: "ODI form name"
            tests:
              - unique
              - not_null 
    - name: D_ODI_type
      description: "Table with ODI type"
      columns:
          - name: odi_type_id
            description: "Id given to ODI type"
            tests:
              - unique
              - not_null 
          - name: odi_type_name 
            description: "ODI type name"
            tests:
              - unique
              - not_null
          - name: odi_type_description
            description: "ODI type description"
            tests:
              - unique
              - not_null
    - name: D_Submission_status
      description: "Table with the type of submission"
      columns:
          - name: submission_status_id
            description: "Id given to submission status"
            tests:
              - unique
              - not_null 
          - name: submission_status_name
            description: "submission status name"
            tests:
              - unique
              - not_null
              - accepted_values:
                  values: ['DRAFT_DETERMINIATION','ACTUAL_APR','Forcast_APR','OFWAT_Intervention']
          - name: submission_status_description
            description: "submission status description"
            tests:
              - unique
              - not_null
    - name: D_PC_company_amp
      description: "Table with connection Performance commitment, company and amp"
      columns:
          - name: pc_company_amp_id
            description: "Unique ids for the row combintion of Performance commitment, company and amp"
            tests:
              - unique
              - not_null
          - name: performance_commitment_id
            description: "Id from performance commitment table for mapping"
            tests:
              - not_null
              - relationships:
                  to: ref('D_Performance_commitment')
                  field: performance_commitment_id
          - name: water_company_id
            description: "Id from Water company table for mapping"
            tests:
              - relationships:
                  to: ref('D_Water_company')
                  field: water_company_id
          - name: unique_id
            description: "Unique identifier for the performance commitment. It will be used in the
                           Ofwat Fountain database and has been generated as follows:
                           PR14 + water company acronym + element acronym + _ + PC reference
                           For example: PR14AFWWSW_W-A1"
            tests:
              - unique
              - not_null
          - name: pc_name
            description: "Name from performance commitment table for mapping"
            tests:
              - not_null
              - relationships:
                  to: ref('D_Performance_commitment')
                  field: pc_name
          - name: outcome
            description: "Name of the outcome (free-format text with no validation)"
            tests:
            - not_null 
          - name: PC_ref
            description: "Free-format, but must be unique within each company’s set of PCs"
            tests:
              - not_null 
          - name: annex
            description: "The order in which the PC appeared in Annex 4 of the PR14 FD company-specific appendix"
            tests:
              - not_null 
          - name: direction_of_improving_performance
            description: "Up if an increase in the numeric value or score means a better (improving) performance
                          Down if a decrease in the numeric value or score means a better (improving) performance
                          Blank if neither of the above apply"
            tests:
              - accepted_values:
                  values: ['Down','Up']
          - name: drinking_water_quality_compliance
            description: "Yes if the PC was included in the PR14 comparative assessment of drinking water quality compliance PCs, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: water_quality_contacts
            description: "Yes if the PC was included in the PR14 comparative assessment of water quality contacts PCs, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: supply_interruptions_3_hours
            description: "Yes if the PC was included in the PR14 comparative assessment of supply interruptions (>3 hours) PCs, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: pollution_incidents_cat_3
            description: "Yes if the PC was included in the PR14 comparative assessment of pollution incidents (category 3) PCs, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: internal_sewer_flooding
            description: "Yes if the PC was included in the PR14 comparative assessment of internal sewer flooding PCs, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: scheme_specific_factors_all_or_part
            description: "Yes if the PC includes scheme-specific factors/elements, otherwise blank
                          We are using this column to highlight PCs that relate, in the main, to specified and/ or major schemes.
                          This is an experimental indicator and not an exact science."
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: asset_health_resilience_all_or_part
            description: "Yes if the PC includes (wholly or partially) asset health work, otherwise blank
                          We are using this column to highlight PCs that relate, wholly or partially, to asset health or resilience.
                          This is an experimental indicator and not an exact science."
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: nep_all_or_part
            description: "Yes if the PC includes (wholly or partially) National Environment Programme (NEP) work, otherwise blank
                          We are using this column to highlight PCs that relate, wholly or partially, to work driven by the National Environment Programme (NEP).
                          This is an experimental indicator and not an exact science."
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: AIM
            description: "Yes if the PC includes (wholly or partially) Abstraction Incentive Mechanism (AIM) work, otherwise blank"
            tests:
            # Anne Does this value will always be yes or blank
              - accepted_values:
                  values: ['Yes']
          - name: no_of_sub_measures
            description: "Count of PC sub-measures"
            tests:
              - not_null 
          - name: standard_odi_operand
            description: "Some PCs with a financial ODI have an incentive rate that uses a fraction or multiple of the PC unit. We are using this column to hold the conversion factor.
                          For example, if rather than being calculated as:
                          £m / PC unit / year
                          the outperformance payment or underperformance payment is calculated as:
                          £m / 0.1 PC unit / year
                          then the conversion factor is 10.000"
          - name: standard_odi_operand_note
            description: "Free-format with no validation"
          - name: UnderP_payment1_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          - name: UnderP_payment2_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          - name: UnderP_payment3_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          - name: UnderP_payment4_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          - name: OutP_payment1_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          - name: OutP_payment2_incentive rate (GBPm)
            description: "Underperformance payment rate in £m
                          Incentives rates that were changed following recalibration based on the company's menu choice are shaded in green"
          # Anne are these fields required in database
          # - name: water_resources
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: water_network_plus
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: wastewater_network_plus
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: Bioresources_sludge
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: residential_retail
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: business_retail
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: direct_procurement_for_customers
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
          # - name: dummy_control
          #   description: ""
          #   tests:
          #     - unique
          #     - not_null 
    - name: D_Financial_incentive_type
      description: "Table with financial incentive type"
      columns:
          - name: financial_incentive_type_id
            description: "Id given to financial incentive type(hash value)"
            tests:
              - unique
              - not_null 
              # Anne
          - name: financial_incentive_type
            description: "This column applies to ODIs that are payable at the end of AMP6
                          Outperformance payment - an outperformance payment has accrued at 31 March
                          Underperformance payment - an underperformance payment has accrued at 31 March
                          Outperformance payment deadband - the actual performance level is within the outperformance payment deadband
                          Underperformance payment deadband - the actual performance level is within the underperformance payment deadband
                          Note: the 'PC list' worksheet does not include the Service Incentive Mechanism (SIM) adjustments in the PR19 final determinations,
                          published December 2019. See the 'Cover' worksheet for further information."
            tests:
              - unique
              - not_null 
          - name: financial_incentive_type_desc
            description: "Types of incentive bands description"
            tests:
              - unique
              - not_null 
    - name: F_PC_apr
      description: "Fact table where all other tables connect"
      columns:
          - name: OFWAT_Year
            description: "The year to which that row belongs to"
            tests:
              - not_null
          - name: submission_status
            description: "The type of submission is it actual or estimated"
            tests:
              - not_null 
          - name: unique_id
            description: "Unique id given to each pc/company/outcome"
            tests:
              - not_null
          - name: water_company_id
            description: "Water company the fact record belong to"
            tests:
              - not_null
          - name: pc_company_amp_id
            description: "PC company amp id"
            tests:
              - not_null
          - name: Submission_status_id
            description: "Submission type if its estimated or actual"
          - name: element_id
            description: "Element it is associated with"
            tests:
              - not_null
          - name: odi_form_id
            description: "odi form"
          - name: odi_type_id
            description: "odi type"
          - name: underp_payment_collar
            description: "underperformance payment collar"
          - name: underp_payment_deadband
            description: "underperformance payment deadband"
          - name: outp_payment_deadband
            description: "outperformance payment deadband"
          - name: outp_payment_cap
            description: "outperformance payment cap"
          - name: pcl
            description: "performance commitment level"
          - name: pcl_met
            description: "Yes - the performance commitment level for that year has been met
                         No - the performance commitment level for that year has not been met
                         Left blank - a performance commitment level has not been set for that year"
          - name: pcl_Actual
            description: "That particular years actual performance in the units the PC is measured in
                          For example, if the PC is measured in Ml/day and the actual performance is 124.5 Ml/day,
                          then this cell will hold the value 124.5
                          This line applies to all PCs, including those with non-financial incentives and
                          those where a performance commitment level has not been set for that year"
          - name: Financial_incentive_type_id
            description: "Id given to financial incentive type(hash value)"
          - name: numeric_pcl_actual
            description: "PCL met for that year, if it is only numeric value is 1 otherwise 0"
          - name: numeric_derived_pcl_actual
            description: "PCL with only numeric values"
          - name: Total_AMP6_outperformance_payment_or_underperformance_payment_forecast
            description: "This column applies to all financial ODIs (that is, ODIs that are payable within AMP6 and ODIs that are payable at the end of AMP6)
                          A forecast of the overall outperformance payment or underperformance payment paid/accrued by the end of AMP6 (31 March 2020) based on your current performance and your current expectation of your future performance.
                          Outperformance payment - an overall outperformance payment is forecast
                          Underperformance payment - an overall underperformance payment is forecast
                          Outperformance payment deadband - if forecast to be within the outperformance payment deadband
                          Underperformance payment deadband - if forecast to be within the underperformance payment deadband"
          - name: Total_AMP6_outperformance_payment_or_underperformance_payment_forecast_GBPm
            description: ""
          - name: notional_incentive_type_id
            description: "This column applies to ODIs that are payable at the end of AMP6
                          Outperformance payment - an outperformance payment has accrued at 31 March 2016
                          Underperformance payment - an underperformance payment has accrued at 31 March 2016
                          Outperformance payment deadband - the actual performance level is within the outperformance payment deadband
                          Underperformance payment deadband - the actual performance level is within the underperformance payment deadband
                          Note: the 'PC list' worksheet does not include the Service Incentive Mechanism (SIM) adjustments in the PR19 final determinations, published December 2019. See the 'Cover' worksheet for further information."
          - name: notional_incentive_payment_accrued_GBPm
            description: "This column applies to ODIs that are payable at the end of AMP6
                          The value of the outperformance payment or underperformance payment accrued at 31 March 2016 (£million)
                          Note: the 'PC list' worksheet does not include the Service Incentive Mechanism (SIM) adjustments in the PR19 final determinations, published December 2019. See the 'Cover' worksheet for further information."
          - name: In_Period_incentive_type_id
            description: "This column applies to ODIs that are payable within AMP6 rather than at the end of AMP6 (that is, some of the Anglian Water, Severn Trent Water and South West Water ODIs)
                          Outperformance payment - an outperformance payment has been earned at 31 March 2016
                          Underperformance payment - an underperformance payment has been earned at 31 March 2016
                          Outperformance payment deadband - the actual performance level is within the outperformance payment deadband
                          Underperformance payment deadband - the actual performance level is within the underperformance payment deadband"
            # tests:  
              # - relationships:
              #     to: ref('D_Financial_incentive_type')
              #     field: financial_incentive_type_desc
          - name: In_Period_payment_GBPm
            description: This column applies to ODIs that are payable within AMP6 rather than at the end of AMP6 (that is, some of the Anglian Water, Severn Trent Water and South West Water ODIs)
                         The value of the outperformance payment or underperformance payment earned at 31 March 2016 (£million)"
            